<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <!-- BASIC META -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <!-- RESPONSIVE META -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- APP INFO -->
        <meta name="author" content="Acsa Cibelly Carvalho Bezerra, Eduardo Aquino da Silva, Stiven Felipe Câmara Fonseca">
        
        <!-- PAGE TITLE -->
        <title>Tank Register - WaterView</title>

        <!-- APP ICON -->

        <!-- CSS STYLESHEETS -->
        <link rel="stylesheet" href="styles/header.css">
        <link rel="stylesheet" href="styles/tank-register.css">

        <!-- JQUERY -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- FONT AWESOME -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    </head>

    <body>
        <header>
            <nav class="navbar">
                <div class="img-container">Img</div>
                <ul class="links">
                    <li><i class="fa fa-calendar-o" aria-hidden="true"></i> <a href="./">Página Inicial</a> </li>
                    <li><i class="fa fa-calendar-o" aria-hidden="true"></i> <a href="history.html">Histórico Mensal</a> </li>
                    <li><i class="fa fa-user-circle-o" aria-hidden="true"></i> <span><a href="">Perfil</a></span></li>
                </ul>
            </nav>
        </header>

        <main>
            <h1>Cadastro de reservatório</h1>

            <form action="" method="POST">
                <div class="form-part-one">
                    <p><input type="text" placeholder=" " id="idNumber" name="" class="inputs"><label for="idNumber">Número de série </label></p>
                    <p><input type="number" min="1" id="idCapacity" name="" class="inputs" placeholder=" "><label for="idCapacity">Capacidade (L) </label></p>
                    
                </div>

                <p class="user-p">
                    <!-- with php and database this will be different -->
                    <select name="" id="idShape">
                        <option value="default" disabled selected>Formato da caixa</option>
                        <option value="1">Quadrática</option>
                        <option value="2">Circular</option>
                    </select>
                </p>

                <div class="form-part-one part-two" id="opts">
                    <p id="opt1"><input type="text" placeholder=" " id="idDimensions1" name="" class="inputs"><label id="dimensionsLabel" for="idDimensions">Dimensões (C x L x H)</label></p>
                    <p id="opt2"><input type="text" placeholder=" " id="idDimensions2" name="" class="inputs"><label id="dimensionsLabel" for="idDimensions">Dimensões (R x H)</label></p>
                </div>

                <p class="user-p">
                    <!-- with php and database this will be different -->
                    <select name="" id="idSel">
                        <option value="default" disabled selected id="selected">Selecione o usuário</option>
                        <option value="">Usuário 1</option>
                        <option value="">Usuário 2</option>
                        <option value="">Usuário 3</option>
                        <option value="">Usuário 4</option>
                        <option value="">Usuário 5</option>
                    </select>
                </p>

                <input type="submit" value="Cadastrar" id="subBtn" disabled>
            </form>
        </main>

        <script>
            const inputNumber = document.getElementById('idNumber')
            const inputCapacity = document.getElementById('idCapacity')
            const inputDimensions1 = document.getElementById('idDimensions1')
            const inputDimensions2 = document.getElementById('idDimensions2')
            const dimensionsLabel = document.getElementById('dimensionsLabel')
            const tankShape = document.getElementById('idShape')
            const opts = document.getElementById('opts')
            const op1 = document.getElementById('opt1')
            const op2 = document.getElementById('opt2')
            const selectElement = document.getElementById("idSel")
            const submitButton = document.getElementById('subBtn')

            inputCapacity.addEventListener('input', validateForm)
            inputNumber.addEventListener('input', validateForm)
            tankShape.addEventListener('change', openDimensions)
            inputDimensions1.addEventListener('input', validateForm)
            inputDimensions1.addEventListener('input', validateDimension)
            inputDimensions2.addEventListener('input', validateForm)
            inputDimensions2.addEventListener('input', validateDimension)
            selectElement.addEventListener('change', validateForm)

            let shapes = [inputDimensions1, inputDimensions2]

            function validateForm() {
                const selectedOption = selectElement.options[selectElement.selectedIndex].value
                if (inputNumber.value.length > 0 && inputCapacity.value.length > 0 && selectedOption != "default" && (dimensionRegExIsValid(shapes[checkShape() - 1].value, checkShape()))) {
                    submitButton.disabled = false
                    submitButton.style.background = "#1e90ff"
                    submitButton.style.color = "#fff"
                    submitButton.style.cursor = "pointer"

                    submitButton.onmouseenter = () => submitButton.style.background = "#66b3ff"
                    submitButton.onmouseleave = () => submitButton.style.background = "#1e90ff"
                } else {
                    submitButton.disabled = true
                    submitButton.style.background = "#a3d1ff"
                    submitButton.style.color = "cornflowerblue"
                    submitButton.style.cursor = "default"
                }
            }

            function dimensionRegExIsValid(dimension, shape) {
                if (shape == 1) {
                    var dimensionRegEx = /[\d]{1,3}[x][\d]{1,3}[x][\d]{1,3}/i;
                } else if (shape == 2) {
                    var dimensionRegEx = /[\d]{1,3}[x][\d]{1,3}/i;
                }
                
                return dimensionRegEx.test(dimension)
            }

            function validateDimension() {
                if (dimensionRegExIsValid(shapes[checkShape() - 1].value, checkShape())) {
                    shapes[checkShape() - 1].style.borderBottom = "2px solid #1e90ff"
                    //inputDimensions1.style.borderBottom = "2px solid #1e90ff"
                    dimensionsLabel.style.color = "#1e90ff"
                } else {
                    shapes[checkShape() - 1].style.borderBottom = "2px solid #f11515"
                    //inputDimensions1.style.borderBottom = "2px solid #f11515"
                    dimensionsLabel.style.color = "#f11515"
                }
            }

            function openDimensions() {
                submitButton.disabled = true
                submitButton.style.background = "#a3d1ff"
                submitButton.style.color = "cornflowerblue"
                submitButton.style.cursor = "default"

                const selectedOpt = tankShape.options[tankShape.selectedIndex].value
                if (selectedOpt == 1) {
                    opts.style.display = "block"
                    op1.style.display = "block"
                    jQuery('#idDimensions2').val("")
                    op2.style.display = "none"
                } else if (selectedOpt == 2) {
                    opts.style.display = "block"
                    jQuery('#idDimensions1').val("")
                    op1.style.display = "none"
                    op2.style.display = "block"
                }

                validateDimension()
            }

            function checkShape() {
                if (op1.style.display == "block" && op2.style.display == "none") {
                    return 1
                } else if (op1.style.display == "none" && op2.style.display == "block") {
                    return 2
                }
            }
        </script>
    </body>
</html>
